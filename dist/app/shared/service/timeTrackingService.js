timeTrackingApp.factory("timeTrackingService",["localStorageService","$http","$q","$httpParamSerializer","StageBASEURL","userModel","companyModel","DemoTimeServiceURL",function(e,t,r,n,s,a,c,o){return{punchTime:function(t){var r=e.get("lastStatus");return null!==r&&r.length>0?this.clockOut(t):this.clockIn(t)},clockIn:function(e){var n=a.getCurrentUser(),s=r.defer(),i=(new Date).toISOString(),l={date:i,recordType:"Work Time",employee:{email:"stage_"+a.getUserEmail(),companyDescriptor:"stage_"+c.getCompanyID(),personDescriptor:"stage_"+a.getUserID()},start:i,checkInAssets:{imageDetectionAsset:{referenceImageAsset:{url:a.getGoldenPhoto(),bucketName:"benefitmy-staging-profile-assets"},realTimeImageAsset:{url:e.url,bucketName:"benefitmy-staging-profile-assets"},confidence:e.confidence}},inProgress:"true"};return t({url:o+"time_punch_cards",method:"POST",data:l,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){n.clockIn=!0,n.clockInId=e.data._id,a.updateUser(n),s.resolve(e)},function(e){s.reject(e)}),s.promise},clockOut:function(n){var s=a.getCurrentUser(),i=r.defer(),l=(new Date).toISOString(),u={date:l,recordType:"Work Time",employee:{email:"stage_"+a.getUserEmail(),companyDescriptor:"stage_"+c.getCompanyID(),personDescriptor:"stage_"+a.getUserID()},end:l,checkOutAssets:{imageDetectionAsset:{referenceImageAsset:{url:"benefitmy-staging-profile-assets",bucketName:"benefitmy-staging-profile-assets"},realTimeImageAsset:{url:n.url,bucketName:"benefitmy-staging-profile-assets"},confidence:n.confidence}},inProgress:"false"},g=e.get("lastStatus");return t({url:o+"time_punch_cards/"+g[0]._id,method:"PUT",data:u,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(t){s.clockIn=null,s.clockInId=null,e.set("lastStatus",null),a.updateUser(s),i.resolve(t)},function(e){s.clockIn=null,s.clockInId=null,i.reject(e)}),i.promise},getUserLatestTimeCardStatus:function(){var r=a.getCurrentUser();t({url:o+"employee/stage_"+r.person.id+"/time_punch_cards?inprogress=true",method:"GET"}).then(function(t){e.set("lastStatus",t.data)},function(e){})}}}]);