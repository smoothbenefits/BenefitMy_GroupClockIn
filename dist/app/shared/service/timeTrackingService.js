timeTrackingApp.factory("timeTrackingService",["localStorageService","$http","$q","$httpParamSerializer","ENV_VARS","userModel","companyModel",function(e,t,r,n,s,a,c){return{punchTime:function(t){var r=e.get("lastStatus");return null!==r&&r.length>0?this.clockOut(t):this.clockIn(t)},clockIn:function(e){var n=a.getCurrentUser(),o=r.defer(),i=(new Date).toISOString(),l={date:i,start:i,createdTimestamp:i,inHours:!1,recordType:"Work Time",employee:{email:a.getUserEmail(),lastName:a.getCurrentUserFisrtName(),firstName:n.last_name,companyDescriptor:s.ENV_PRE+c.getCompanyID(),personDescriptor:s.ENV_PRE+n.person.user},checkInAssets:{imageDetectionAsset:{referenceImageAsset:{url:a.getGoldenPhoto(),bucketName:s.IMAGE_S3_BUCKET},realTimeImageAsset:{url:e.url,bucketName:s.IMAGE_S3_BUCKET},confidence:e.confidence}},inProgress:"true"};return t({url:s.DemoTimeServiceURL+"time_punch_cards",method:"POST",data:l,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){n.clockIn=!0,n.clockInId=e.data._id,a.updateUser(n),o.resolve(e)},function(e){o.reject(e)}),o.promise},clockOut:function(n){var o=a.getCurrentUser(),i=r.defer(),l=(new Date).toISOString(),u={date:l,recordType:"Work Time",employee:{email:a.getUserEmail(),lastName:a.getCurrentUserFisrtName(),firstName:o.last_name,companyDescriptor:s.ENV_PRE+c.getCompanyID(),personDescriptor:s.ENV_PRE+o.person.user},end:l,checkOutAssets:{imageDetectionAsset:{referenceImageAsset:{url:a.getGoldenPhoto(),bucketName:s.IMAGE_S3_BUCKET},realTimeImageAsset:{url:n.url,bucketName:s.IMAGE_S3_BUCKET},confidence:n.confidence}},inProgress:"false"},m=e.get("lastStatus");return t({url:s.DemoTimeServiceURL+"time_punch_cards/"+m[0]._id,method:"PUT",data:u,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(t){o.clockIn=null,o.clockInId=null,e.set("lastStatus",null),a.updateUser(o),i.resolve(t)},function(e){o.clockIn=null,o.clockInId=null,i.reject(e)}),i.promise},getUserLatestTimeCardStatus:function(){var r=a.getCurrentUser();t({url:s.DemoTimeServiceURL+"employee/"+s.ENV_PRE+r.person.user+"/time_punch_cards?inprogress=true",method:"GET"}).then(function(t){e.set("lastStatus",t.data)},function(e){})}}}]);