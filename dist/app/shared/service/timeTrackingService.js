timeTrackingApp.factory("timeTrackingService",["localStorageService","$http","$q","$httpParamSerializer","ENV_VARS","userModel","companyModel",function(e,t,r,n,a,c,s){return{punchTime:function(t){var r=e.get("lastStatus");return null!==r&&r.length>0?this.clockOut(t):this.clockIn(t)},clockIn:function(e){var n=c.getCurrentUser(),o=r.defer(),i=(new Date).toISOString(),l={date:i,start:i,createdTimestamp:i,inHours:!1,recordType:"Work Time",employee:{email:c.getUserEmail(),lastName:c.getCurrentUserFisrtName(),firstName:n.last_name,companyDescriptor:a.ENV_PRE+s.getCompanyID(),personDescriptor:a.ENV_PRE+n.person.id},checkInAssets:{imageDetectionAsset:{referenceImageAsset:{url:c.getGoldenPhoto(),bucketName:a.IMAGE_S3_BUCKET},realTimeImageAsset:{url:e.url,bucketName:a.IMAGE_S3_BUCKET},confidence:e.confidence}},inProgress:"true"};return t({url:a.DemoTimeServiceURL+"time_punch_cards",method:"POST",data:l,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){n.clockIn=!0,n.clockInId=e.data._id,c.updateUser(n),o.resolve(e)},function(e){o.reject(e)}),o.promise},clockOut:function(n){var o=c.getCurrentUser(),i=r.defer(),l=(new Date).toISOString(),u={date:l,recordType:"Work Time",employee:{email:c.getUserEmail(),lastName:c.getCurrentUserFisrtName(),firstName:o.last_name,companyDescriptor:a.ENV_PRE+s.getCompanyID(),personDescriptor:a.ENV_PRE+o.person.id},end:l,checkOutAssets:{imageDetectionAsset:{referenceImageAsset:{url:c.getGoldenPhoto(),bucketName:a.IMAGE_S3_BUCKET},realTimeImageAsset:{url:n.url,bucketName:a.IMAGE_S3_BUCKET},confidence:n.confidence}},inProgress:"false"},m=e.get("lastStatus");return t({url:a.DemoTimeServiceURL+"time_punch_cards/"+m[0]._id,method:"PUT",data:u,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(t){o.clockIn=null,o.clockInId=null,e.set("lastStatus",null),c.updateUser(o),i.resolve(t)},function(e){o.clockIn=null,o.clockInId=null,i.reject(e)}),i.promise},getUserLatestTimeCardStatus:function(){var r=c.getCurrentUser();t({url:a.DemoTimeServiceURL+"employee/"+a.ENV_PRE+r.person.id+"/time_punch_cards?inprogress=true",method:"GET"}).then(function(t){e.set("lastStatus",t.data)},function(e){})}}}]);