timeTrackingApp.factory("timeTrackingService",["localStorageService","$http","$q","$httpParamSerializer","ENV_VARS","userModel","companyModel",function(e,t,r,n,s,a,c){return{punchTime:function(t){var r=e.get("lastStatus");return null!==r&&r.length>0?this.clockOut(t):this.clockIn(t)},clockIn:function(e){var n=a.getCurrentUser(),i=r.defer(),o=(new Date).toISOString(),l={date:o,start:o,createdTimestamp:o,inHours:!1,recordType:"Work Time",employee:{email:a.getUserEmail(),lastName:a.getCurrentUserFisrtName(),firstName:n.first_name,companyDescriptor:"stage_"+c.getCompanyID(),personDescriptor:"stage_"+a.getUserID()},checkInAssets:{imageDetectionAsset:{referenceImageAsset:{url:a.getGoldenPhoto(),bucketName:s.IMAGE_S3_BUCKET},realTimeImageAsset:{url:e.url,bucketName:s.IMAGE_S3_BUCKET},confidence:e.confidence}},inProgress:"true"};return t({url:s.DemoTimeServiceURL+"time_punch_cards",method:"POST",data:l,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){n.clockIn=!0,n.clockInId=e.data._id,a.updateUser(n),i.resolve(e)},function(e){i.reject(e)}),i.promise},clockOut:function(n){var i=a.getCurrentUser(),o=r.defer(),l=(new Date).toISOString(),u={date:l,recordType:"Work Time",employee:{email:a.getUserEmail(),lastName:a.getCurrentUserFisrtName(),firstName:i.first_name,companyDescriptor:"stage_"+c.getCompanyID(),personDescriptor:"stage_"+a.getUserID()},end:l,checkOutAssets:{imageDetectionAsset:{referenceImageAsset:{url:"benefitmy-staging-profile-assets",bucketName:s.IMAGE_S3_BUCKET},realTimeImageAsset:{url:n.url,bucketName:s.IMAGE_S3_BUCKET},confidence:n.confidence}},inProgress:"false"},m=e.get("lastStatus");return t({url:s.DemoTimeServiceURL+"time_punch_cards/"+m[0]._id,method:"PUT",data:u,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(t){i.clockIn=null,i.clockInId=null,e.set("lastStatus",null),a.updateUser(i),o.resolve(t)},function(e){i.clockIn=null,i.clockInId=null,o.reject(e)}),o.promise},getUserLatestTimeCardStatus:function(){var r=a.getCurrentUser();t({url:s.DemoTimeServiceURL+"employee/stage_"+r.person.id+"/time_punch_cards?inprogress=true",method:"GET"}).then(function(t){e.set("lastStatus",t.data)},function(e){})}}}]);