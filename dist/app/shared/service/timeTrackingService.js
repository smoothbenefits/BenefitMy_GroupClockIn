timeTrackingApp.factory("timeTrackingService",["localStorageService","$http","$q","$httpParamSerializer","ENV_VARS","userModel","companyModel",function(e,t,r,n,a,s,c){return{punchTime:function(t){var r=e.get("lastStatus");return null!==r&&r.length>0?this.clockOut(t):this.clockIn(t)},clockIn:function(e){var n=s.getCurrentUser(),o=r.defer(),i=(new Date).toISOString(),l={date:i,start:i,createdTimestamp:i,inHours:!1,recordType:"Work Time",employee:{email:s.getUserEmail(),lastName:s.getCurrentUserFisrtName(),firstName:n.last_name,companyDescriptor:"stage_"+c.getCompanyID(),personDescriptor:"stage_"+n.person.id},checkInAssets:{imageDetectionAsset:{referenceImageAsset:{url:s.getGoldenPhoto(),bucketName:a.IMAGE_S3_BUCKET},realTimeImageAsset:{url:e.url,bucketName:a.IMAGE_S3_BUCKET},confidence:e.confidence}},inProgress:"true"};return t({url:a.DemoTimeServiceURL+"time_punch_cards",method:"POST",data:l,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){n.clockIn=!0,n.clockInId=e.data._id,s.updateUser(n),o.resolve(e)},function(e){o.reject(e)}),o.promise},clockOut:function(n){var o=s.getCurrentUser(),i=r.defer(),l=(new Date).toISOString(),u={date:l,recordType:"Work Time",employee:{email:s.getUserEmail(),lastName:s.getCurrentUserFisrtName(),firstName:o.last_name,companyDescriptor:"stage_"+c.getCompanyID(),personDescriptor:"stage_"+o.person.id},end:l,checkOutAssets:{imageDetectionAsset:{referenceImageAsset:{url:"benefitmy-staging-profile-assets",bucketName:a.IMAGE_S3_BUCKET},realTimeImageAsset:{url:n.url,bucketName:a.IMAGE_S3_BUCKET},confidence:n.confidence}},inProgress:"false"},m=e.get("lastStatus");return t({url:a.DemoTimeServiceURL+"time_punch_cards/"+m[0]._id,method:"PUT",data:u,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(t){o.clockIn=null,o.clockInId=null,e.set("lastStatus",null),s.updateUser(o),i.resolve(t)},function(e){o.clockIn=null,o.clockInId=null,i.reject(e)}),i.promise},getUserLatestTimeCardStatus:function(){var r=s.getCurrentUser();t({url:a.DemoTimeServiceURL+"employee/stage_"+r.person.id+"/time_punch_cards?inprogress=true",method:"GET"}).then(function(t){e.set("lastStatus",t.data)},function(e){})}}}]);