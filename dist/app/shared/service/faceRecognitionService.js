timeTrackingApp.factory("faceRecognitionService",["$http","$q","userModel","localStorageService","timeTrackingService","companyModel","StageBASEURL",function(e,t,n,o,r,a,i){function c(e){for(var t=atob(e.split(",")[1]),n=[],o=0;o<t.length;o++)n.push(t.charCodeAt(o));return new Blob([new Uint8Array(n)],{type:"image/jpeg"})}function s(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)})}AWS.config.update({accessKeyId:"AKIAJVLVZOIR5KDYVMTA",secretAccessKey:"/iDlv9bwAUcz1qJNaKjAzVGV6X3oHXG2O4zye61z"}),AWS.config.region="us-east-1";var u=new AWS.Rekognition,g=new AWS.S3({params:{Bucket:"benefitmy-staging-profile-assets"}});return{uploadImage:function(e){var n=c(e),o={Key:s(),Body:n,ContentType:"image/jpeg"},r=t.defer();return g.upload(o,function(e,t){e||r.resolve(t)}),r.promise},uploadGoldenPicture:function(o){this.uploadImage(o).then(function(o){var c=t.defer(),s=o.Location;return e({url:i+n.getUserID(),method:"PUT",data:{photo_url:s,person:n.getUserID(),company:a.getCompanyID()},headers:{"Content-Type":"application/json"}}).then(function(e){console.log(e),n.setCurrentUser(e.data),r.clockIn(s),c.resolve(e)},function(e){c.reject(e),console.log(e)}),c.promise})},getRecognitionResult:function(e){var o=t.defer();this.uploadImage(e).then(function(e){var t=e.Location,r={SimilarityThreshold:1,SourceImage:{S3Object:{Bucket:"benefitmy-staging-profile-assets",Name:n.getGoldenPhotoID()}},TargetImage:{S3Object:{Bucket:"benefitmy-staging-profile-assets",Name:e.key}}};u.compareFaces(r,function(e,n){e?o.reject(e):o.resolve({url:t,confidence:n.FaceMatches[0].Similarity})})});return o.promise}}}]);