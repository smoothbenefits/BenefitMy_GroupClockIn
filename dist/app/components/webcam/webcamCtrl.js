!function(){"use strict";timeTrackingApp.controller("WebcamCtrl",["$scope","$state","$mdToast","$mdDialog","webcamService","faceRecognitionService","userModel","timeTrackingService","localStorageService",function(e,o,n,t,a,c,i,l,r){e.status=i.isCurrentUserClockIn()?"out":"in",e.username=i.getUserName();var s=r.get("lastStatus");if(null!==s&&s.length>0){var u=new Date(s[0].start);e.lastClockIn="Your last Clock In time: "+u.toString("dddd, MMMM d, yyyy hh:mm tt")}e.channel=a.webcam.channel,e.exitWebcam=function(){o.go("pinLogin")},e.onSuccess=function(){a.webcam.onSuccess(),e.showButton=!0,e.$apply(function(){e.showButton=!0})},e.onStream=a.webcam.onStream,e.makeSnapshot=a.webcam.makeSnapshot,e.onError=function(){e.$apply(),a.webcam.onError(),n.show(n.simple().content("Please reboot device!").theme("error-toast").hideDelay(8e3))},a.webcam.showDialog=function(e){function n(e,o){e.dialog_status=i.isCurrentUserClockIn()?"out":"in",e.photo=o,e.cancel=function(){t.cancel()},e.answer=function(e){t.cancel()},e.upload=function(){if(!i.hasGoldenPhoto())return c.uploadGoldenPicture(o).then(function(e){console.log(e),t.hide(!0),l.punchTime(e)},function(e){console.log(e),t.hide(!1)}),!0;c.getRecognitionResult(o).then(function(e){console.log(e),t.hide(!0),l.punchTime(e)},function(e){console.log(e),t.hide(!1)})}}n.$inject=["$scope","image"],t.show({controller:n,templateUrl:"app/components/templates/confirmDialog.tmpl.html",parent:angular.element(document.body),clickOutsideToClose:!1,fullscreen:!0,locals:{image:e}}).then(function(e){if(!0===e){var n="";n=i.isCurrentUserClockIn()?"Thank you! "+i.getCurrentUserFisrtName()+"ï¼Œyou are Clock Out!":"Thank you! "+i.getCurrentUserFisrtName()+", you are Clock In!",t.show(t.alert().clickOutsideToClose(!0).title("Confirm Message").textContent(n).ariaLabel(n).ok("Okay!")).finally(function(){a.webcam.turnOff(),o.go("pinLogin")})}else if(!1===e){var c="Unable to upload photo, please contact HR!";t.show(t.alert().clickOutsideToClose(!0).title("Error").textContent(c).ariaLabel(c).ok("Okay!")).finally(function(){a.webcam.turnOff(),o.go("pinLogin")})}},function(){})}}])}();