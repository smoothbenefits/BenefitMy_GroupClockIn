!function(){"use strict";timeTrackingApp.controller("WebcamCtrl",["$scope","$state","$mdToast","$mdDialog","webcamService","faceRecognitionService","userModel","timeTrackingService","localStorageService",function(e,t,n,o,a,c,i,l,r){e.status=i.isCurrentUserClockIn()?"out":"in",e.username=i.getUserName();var s=r.get("lastStatus");if(null!==s&&s.length>0){var u=new Date(s[0].start);e.lastClockIn="Your last Clock In time: "+u.toString("dddd, MMMM d, yyyy hh:mm tt")}e.channel=a.webcam.channel,e.exitWebcam=function(){t.go("pinLogin")},e.onSuccess=function(){a.webcam.onSuccess(),e.showButton=!0,e.$apply(function(){e.showButton=!0})},e.onStream=a.webcam.onStream,e.makeSnapshot=a.webcam.makeSnapshot,e.onError=function(){e.$apply(),a.webcam.onError(),n.show(n.simple().content("Please reboot device!").theme("error-toast").hideDelay(8e3))},a.webcam.showDialog=function(e){function n(e,t){e.dialog_status=i.isCurrentUserClockIn()?"out":"in",e.photo=t,e.cancel=function(){o.cancel()},e.answer=function(e){o.cancel()},e.upload=function(){if(!i.hasGoldenPhoto())return c.uploadGoldenPicture(t).then(function(e){console.log(e),o.hide(!0),l.punchTime(e)},function(e){console.log(e),o.hide(!1)}),!0;c.getRecognitionResult(t).then(function(e){console.log(e),o.hide(!0),l.punchTime(e)},function(e){console.log(e),o.hide(!1)})}}n.$inject=["$scope","image"],o.show({controller:n,templateUrl:"app/components/templates/confirmDialog.tmpl.html",parent:angular.element(document.body),clickOutsideToClose:!1,fullscreen:!0,locals:{image:e}}).then(function(e){if(!0===e){var n="";n=i.isCurrentUserClockIn()?"Thank you! "+i.getCurrentUserFisrtName()+"ï¼Œyou are Clock Out!":"Thank you! "+i.getCurrentUserFisrtName()+", you are Clock In!",o.show(o.alert().clickOutsideToClose(!0).title("Confirm Message").textContent(n).ariaLabel(n).ok("Okay!")).finally(function(){r.set("lastStatus",null),a.webcam.turnOff(),t.go("pinLogin")})}else if(!1===e){var c="Unable to upload photo, please contact HR!";o.show(o.alert().clickOutsideToClose(!0).title("Error").textContent(c).ariaLabel(c).ok("Okay!")).finally(function(){a.webcam.turnOff(),t.go("pinLogin")})}},function(){})}}])}();